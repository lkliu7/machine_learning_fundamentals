(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[     10252,        293]
NotebookOptionsPosition[      9430,        274]
NotebookOutlinePosition[      9821,        290]
CellTagsIndexPosition[      9778,        287]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"mnist", "=", 
   RowBox[{"ResourceData", "[", 
    RowBox[{"\"\<MNIST\>\"", ",", "\"\<TrainingData\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mnistTest", "=", 
   RowBox[{"ResourceData", "[", 
    RowBox[{"\"\<MNIST\>\"", ",", "\"\<TestData\>\""}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"group", "[", "i_", "]"}], ":=", 
   RowBox[{
    RowBox[{"group", "[", "i", "]"}], "=", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"mnist", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "==", "i"}], "&"}]}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"groupTest", "[", "i_", "]"}], ":=", 
   RowBox[{
    RowBox[{"groupTest", "[", "i", "]"}], "=", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"mnistTest", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "==", "i"}], "&"}]}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nums", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "8"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"group", "/@", "nums"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vec", "[", "img_", "]"}], ":=", 
  RowBox[{"1", "-", 
   RowBox[{"Flatten", "[", 
    RowBox[{"ImageData", "[", "img", "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"l", "[", "x_", "]"}], ":=", 
  FractionBox["1", 
   RowBox[{"1", "+", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{"-", "x"}]]}]]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lC", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"x", ",", "_Real"}], "}"}], "}"}], ",", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"-", "x"}]]}], ")"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", 
   RowBox[{"Length", "[", "data", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.973014402911982*^9, 3.9730144144979067`*^9}, {
   3.9730252040203743`*^9, 3.973025204756147*^9}, 3.973034322253763*^9, {
   3.973867878452237*^9, 3.973867891413102*^9}, {3.9742489818673964`*^9, 
   3.974248998846047*^9}, {3.97425098644695*^9, 3.974251015387321*^9}, 
   3.974251214546698*^9, {3.9742512708290052`*^9, 3.974251292806039*^9}, {
   3.9742523775653563`*^9, 3.974252378607732*^9}, {3.97425242656113*^9, 
   3.974252427010623*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"bc3bbe80-c544-4ee4-a730-380c070d96a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"vec", "/@", "data"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"y", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"1", ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.974248971832637*^9, 3.974248973740443*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"f3e0986a-f018-45ab-a654-530e96c8fb08"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"error", "[", "w_", "]"}], ":=", 
  RowBox[{"Total", "[", 
   RowBox[{"l", "/@", 
    RowBox[{"(", 
     RowBox[{"y", " ", 
      RowBox[{"X", ".", "w"}]}], ")"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", "w_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"lC", "/@", 
       RowBox[{"(", 
        RowBox[{"y", " ", 
         RowBox[{"X", ".", "w"}]}], ")"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"y", " ", "p", 
       RowBox[{"(", 
        RowBox[{"1", "-", "p"}], ")"}]}], ")"}], ".", "X"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.974249009834613*^9, 3.974249105455166*^9}, {
   3.974249155372285*^9, 3.974249156290406*^9}, {3.974249275456707*^9, 
   3.974249281923689*^9}, {3.9742499327646847`*^9, 3.974249980833791*^9}, {
   3.9742501173222857`*^9, 3.974250122227528*^9}, {3.974250238606969*^9, 
   3.974250243026784*^9}, {3.974250698598267*^9, 3.974250708967237*^9}, {
   3.974251028200165*^9, 3.974251043342675*^9}, {3.974251085761022*^9, 
   3.974251097680037*^9}, {3.9742512761511374`*^9, 3.974251281211604*^9}, {
   3.974251883996002*^9, 3.974251948973258*^9}, {3.974251983343659*^9, 
   3.974251996965941*^9}, 3.974252169628359*^9, 3.9742523099131107`*^9},
 CellLabel->"In[13]:=",ExpressionUUID->"a90c53e9-e5a6-49d4-a900-7baa2a502f8f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"lr", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "3"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iters", "=", "1000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"w", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "784"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"0", ",", "\"\< \>\"", ",", 
    RowBox[{"error", "[", "w", "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"w", "-=", 
     RowBox[{"lr", " ", 
      RowBox[{"grad", "[", "w", "]"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Mod", "[", 
        RowBox[{"i", ",", "100"}], "]"}], "==", "0"}], ",", 
      RowBox[{"Print", "[", 
       RowBox[{"i", ",", "\"\< \>\"", ",", 
        RowBox[{"error", "[", "w", "]"}]}], "]"}]}], "]"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "iters"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.974249183104404*^9, 3.9742492663018427`*^9}, {
  3.9742495870053387`*^9, 3.974249614892198*^9}, {3.974252175670184*^9, 
  3.974252185372764*^9}, {3.974252324639469*^9, 3.974252337694797*^9}, {
  3.974303480361311*^9, 3.974303490095674*^9}, {3.9743061104598103`*^9, 
  3.974306110614296*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"5a09f7e2-5304-4a3c-848a-d97f05426274"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pred", "[", "x_", "]"}], ":=", 
  RowBox[{"Sign", "[", 
   RowBox[{"-", 
    RowBox[{"w", ".", "x"}]}], "]"}]}]], "Input",
 CellChangeTimes->{3.9742522778153563`*^9},
 CellLabel->"In[20]:=",ExpressionUUID->"9568d9b6-4009-47fe-bfcf-b11bd2b42c37"],

Cell[BoxData[{
 RowBox[{"trainAcc1", "=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Count", "[", 
     RowBox[{
      RowBox[{"pred", "/@", 
       RowBox[{"vec", "/@", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", "1"}], "]"}], "/", 
    RowBox[{"Length", "[", 
     RowBox[{"group", "[", 
      RowBox[{"nums", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{"trainAcc2", "=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Count", "[", 
     RowBox[{
      RowBox[{"pred", "/@", 
       RowBox[{"vec", "/@", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], ",", 
      RowBox[{"-", "1"}]}], "]"}], "/", 
    RowBox[{"Length", "[", 
     RowBox[{"group", "[", 
      RowBox[{"nums", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{"testAcc1", "=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Count", "[", 
     RowBox[{
      RowBox[{"pred", "/@", 
       RowBox[{"vec", "/@", 
        RowBox[{"groupTest", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", "1"}], "]"}], "/", 
    RowBox[{"Length", "[", 
     RowBox[{"groupTest", "[", 
      RowBox[{"nums", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{"testAcc2", "=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Count", "[", 
     RowBox[{
      RowBox[{"pred", "/@", 
       RowBox[{"vec", "/@", 
        RowBox[{"groupTest", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], ",", 
      RowBox[{"-", "1"}]}], "]"}], "/", 
    RowBox[{"Length", "[", 
     RowBox[{"groupTest", "[", 
      RowBox[{"nums", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{"Print", "[", 
  RowBox[{"{", 
   RowBox[{"trainAcc1", ",", "trainAcc2", ",", "testAcc1", ",", "testAcc2"}], 
   "}"}], "]"}]}], "Input",
 CellLabel->"In[21]:=",ExpressionUUID->"248fd151-8b2e-4447-9ce6-360b03451422"]
},
WindowSize->{864, 1051},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e5afe1a9-6b53-44fb-ac40-113a9a5b6ea8"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 2818, 80, 232, "Input",ExpressionUUID->"bc3bbe80-c544-4ee4-a730-380c070d96a3"],
Cell[3375, 102, 825, 23, 49, "Input",ExpressionUUID->"f3e0986a-f018-45ab-a654-530e96c8fb08"],
Cell[4203, 127, 1405, 33, 49, "Input",ExpressionUUID->"a90c53e9-e5a6-49d4-a900-7baa2a502f8f"],
Cell[5611, 162, 1411, 36, 131, "Input",ExpressionUUID->"5a09f7e2-5304-4a3c-848a-d97f05426274"],
Cell[7025, 200, 280, 7, 29, "Input",ExpressionUUID->"9568d9b6-4009-47fe-bfcf-b11bd2b42c37"],
Cell[7308, 209, 2118, 63, 111, "Input",ExpressionUUID->"248fd151-8b2e-4447-9ce6-360b03451422"]
}
]
*)

