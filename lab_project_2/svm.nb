(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[     31139,        856]
NotebookOptionsPosition[     29097,        816]
NotebookOutlinePosition[     29488,        832]
CellTagsIndexPosition[     29445,        829]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Setup", "Section",
 CellChangeTimes->{{3.975117193219819*^9, 
  3.975117193667238*^9}},ExpressionUUID->"7ca5f1cd-f358-42fd-96e9-\
3ac7d11fea99"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mnist", "=", 
   RowBox[{"ResourceData", "[", 
    RowBox[{"\"\<MNIST\>\"", ",", "\"\<TrainingData\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mnistTest", "=", 
   RowBox[{"ResourceData", "[", 
    RowBox[{"\"\<MNIST\>\"", ",", "\"\<TestData\>\""}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"group", "[", "i_", "]"}], ":=", 
  RowBox[{
   RowBox[{"group", "[", "i", "]"}], "=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"mnist", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "==", "i"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trainSize", "[", "i_", "]"}], ":=", 
  RowBox[{
   RowBox[{"trainSize", "[", "i", "]"}], "=", 
   RowBox[{"Length", "[", 
    RowBox[{"group", "[", "i", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"groupTest", "[", "i_", "]"}], ":=", 
  RowBox[{
   RowBox[{"groupTest", "[", "i", "]"}], "=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"mnistTest", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "==", "i"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testSize", "[", "i_", "]"}], ":=", 
  RowBox[{
   RowBox[{"testSize", "[", "i", "]"}], "=", 
   RowBox[{"Length", "[", 
    RowBox[{"groupTest", "[", "i", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"vec", "[", "img_", "]"}], ":=", 
  RowBox[{"1", "-", 
   RowBox[{"Flatten", "[", 
    RowBox[{"ImageData", "[", "img", "]"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.975190298535763*^9, 3.975190299340508*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"dfa783ae-a4f4-4ca2-b14c-c8f9868fadbd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Primary formulation", "Section",
 CellChangeTimes->{{3.975114897433956*^9, 
  3.975114911159115*^9}},ExpressionUUID->"769dd8b2-357b-4d11-9b99-\
7b7bfea82f9c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"h", "[", "x_", "]"}], ":=", 
  RowBox[{"Ramp", "[", 
   RowBox[{"1", "-", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"th", "[", "x_", "]"}], ":=", 
  RowBox[{"Boole", "[", 
   RowBox[{"x", ">=", "0"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"error", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    SuperscriptBox[
     RowBox[{"Norm", "[", "w", "]"}], "2"], "/", "2"}], "+", 
   RowBox[{"c", " ", 
    RowBox[{"Total", "[", 
     RowBox[{"h", "[", 
      RowBox[{"y", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradw", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"1", "-", 
       RowBox[{"y", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}]}]}], "}"}], ",", 
    RowBox[{"w", "-", 
     RowBox[{"c", " ", 
      RowBox[{"Total", "[", 
       RowBox[{"X", " ", "y", " ", 
        RowBox[{"th", "/@", "p"}]}], "]"}]}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradb", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"1", "-", 
       RowBox[{"y", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"-", "c"}], " ", 
     RowBox[{"Total", "[", 
      RowBox[{"y", " ", 
       RowBox[{"th", "/@", "p"}]}], "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.975114914162221*^9, 3.975114962839511*^9}, {
   3.97511500989281*^9, 3.9751150147233686`*^9}, {3.975115074378886*^9, 
   3.975115080002192*^9}, {3.975115139210668*^9, 3.9751151542999277`*^9}, {
   3.9751152088865833`*^9, 3.975115214334865*^9}, {3.975116040119091*^9, 
   3.975116041714136*^9}, {3.975116862896227*^9, 3.975116901970756*^9}, {
   3.975116964723078*^9, 3.975117069020783*^9}, {3.975117149748046*^9, 
   3.975117149831997*^9}, {3.975169315290042*^9, 3.9751693741143007`*^9}, 
   3.975169455856101*^9, {3.975169516119421*^9, 3.975169556031191*^9}, {
   3.975189865170492*^9, 
   3.975189876777871*^9}},ExpressionUUID->"4db99a3d-ad92-45ed-834b-\
1e930a180994"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nums", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "8"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"group", "/@", "nums"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"vec", "/@", "data"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"y", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"1", ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", 
   RowBox[{"Length", "[", "y", "]"}]}], ";"}]}], "Input",ExpressionUUID->\
"567ea129-b721-497b-ae7f-51fc3535c904"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"lr", "=", 
   RowBox[{"1", " ", 
    SuperscriptBox["10", 
     RowBox[{"-", "4"}]]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iters", "=", "100000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"w", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "784"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"c", "=", "0.25"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"0", ",", "\"\< \>\"", ",", 
   RowBox[{"prevError", "=", 
    RowBox[{"error", "[", 
     RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"AbsoluteTiming", "[", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"w", "-=", 
      RowBox[{"lr", " ", 
       RowBox[{"gradw", "[", 
        RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"b", "-=", 
      RowBox[{"lr", " ", 
       RowBox[{"gradb", "[", 
        RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"currentError", "=", 
      RowBox[{"error", "[", 
       RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{"i", ",", "100"}], "]"}], "==", "0"}], ",", 
       RowBox[{"Print", "[", 
        RowBox[{"i", ",", "\"\< \>\"", ",", "currentError"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"prevError", "/", "currentError"}], "-", "1"}], "]"}], "<", 
        "tol"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<converged at iteration \>\"", ",", " ", "i"}], "]"}], ";", 
        RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"prevError", "=", "currentError"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "iters"}], "}"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.974379405452724*^9, 3.974379407813608*^9}, {
   3.974379449932362*^9, 3.974379460166787*^9}, 3.974379555108316*^9, {
   3.974379657961217*^9, 3.9743796902112207`*^9}, {3.97438004421542*^9, 
   3.974380078389139*^9}, 3.9743804217406673`*^9, {3.974380695559587*^9, 
   3.9743807233226*^9}, 3.974562969381998*^9, {3.975034517403051*^9, 
   3.975034517504919*^9}, {3.975082359654324*^9, 3.9750823604838133`*^9}, {
   3.9751171246231127`*^9, 3.975117165270938*^9}, {3.975122578480524*^9, 
   3.975122578817071*^9}, 3.975170287267139*^9, {3.975190338259795*^9, 
   3.975190349058485*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"f4a88bee-36d4-488d-978f-302997e48135"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Multi-class SVM", "Section",
 CellChangeTimes->{{3.975190007433855*^9, 
  3.975190015423834*^9}},ExpressionUUID->"58877aa2-3427-4db6-a4f3-\
64f5a544e457"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"h", "[", "x_", "]"}], ":=", 
  RowBox[{"Ramp", "[", 
   RowBox[{"1", "-", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"th", "[", "x_", "]"}], ":=", 
  RowBox[{"Boole", "[", 
   RowBox[{"x", ">=", "0"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"error", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    SuperscriptBox[
     RowBox[{"Norm", "[", "w", "]"}], "2"], "/", "2"}], "+", 
   RowBox[{"c", " ", 
    RowBox[{"Total", "[", 
     RowBox[{"h", "[", 
      RowBox[{"y", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradw", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"1", "-", 
       RowBox[{"y", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}]}]}], "}"}], ",", 
    RowBox[{"w", "-", 
     RowBox[{"c", " ", 
      RowBox[{"Total", "[", 
       RowBox[{"X", " ", "y", " ", 
        RowBox[{"th", "/@", "p"}]}], "]"}]}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gradb", "[", 
   RowBox[{"w_", ",", "b_", ",", "c_", ",", "X_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"1", "-", 
       RowBox[{"y", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"X", ".", "w"}], "+", "b"}], ")"}]}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"-", "c"}], " ", 
     RowBox[{"Total", "[", 
      RowBox[{"y", " ", 
       RowBox[{"th", "/@", "p"}]}], "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pairs", "=", 
   RowBox[{"Subsets", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", "9"}], "]"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lr", "=", 
   RowBox[{"1", " ", 
    SuperscriptBox["10", 
     RowBox[{"-", "4"}]]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iters", "=", "100000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"c", "=", "0.25"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"results", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "data", ",", "X", ",", "y", ",", "n", ",", "w", ",", "b", ",", 
         "prevError", ",", "currentError"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"Join", "@@", 
          RowBox[{"group", "/@", "nums"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"X", "=", 
         RowBox[{"vec", "/@", "data"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"y", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"group", "[", 
               RowBox[{"nums", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"group", "[", 
               RowBox[{"nums", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "y", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", "784"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"b", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"prevError", "=", 
         RowBox[{"error", "[", 
          RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"w", "-=", 
            RowBox[{"lr", " ", 
             RowBox[{"gradw", "[", 
              RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"b", "-=", 
            RowBox[{"lr", " ", 
             RowBox[{"gradb", "[", 
              RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"currentError", "=", 
            RowBox[{"error", "[", 
             RowBox[{"w", ",", "b", ",", "c", ",", "X", ",", "y"}], "]"}]}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{
                RowBox[{"prevError", "/", "currentError"}], "-", "1"}], "]"}],
               "<", "tol"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"prevError", "=", "currentError"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "iters"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"nums", ",", "w", ",", "b"}], "}"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"nums", ",", "pairs"}], "}"}], ",", 
     RowBox[{"Method", "->", "\"\<FinestGrained\>\""}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"w", "[", 
      RowBox[{"result", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "=", 
     RowBox[{"result", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"b", "[", 
      RowBox[{"result", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "=", 
     RowBox[{"result", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"result", ",", "results"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"predPair", "[", 
   RowBox[{"pair_", ",", "img_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vec", "=", 
      RowBox[{"vec", "[", "img", "]"}]}], "}"}], ",", 
    RowBox[{"pair", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Sign", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"w", "[", "pair", "]"}], ".", "vec"}], "+", 
           RowBox[{"b", "[", "pair", "]"}]}], "]"}]}], "/", "2"}], "+", 
       RowBox[{"3", "/", "2"}]}], "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pred", "[", "img_", "]"}], ":=", 
  RowBox[{
   RowBox[{"RandomChoice", "[", 
    RowBox[{"MaximalBy", "[", 
     RowBox[{
      RowBox[{"Tally", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"predPair", "[", 
          RowBox[{"pair", ",", "img"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"pair", ",", "pairs"}], "}"}]}], "]"}], "]"}], ",", 
      "Last"}], "]"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.975190019611651*^9, 3.975190157965479*^9}, {
   3.975190245160082*^9, 3.975190288207839*^9}, {3.975190382168745*^9, 
   3.975190391119507*^9}, {3.975190427477607*^9, 3.975190431291244*^9}, {
   3.9751905074657307`*^9, 3.975190616453528*^9}, {3.975190691919552*^9, 
   3.975190782148037*^9}, {3.975190891905718*^9, 3.9751909228149014`*^9}, {
   3.975190973294026*^9, 3.975190979351953*^9}, {3.975191158474218*^9, 
   3.975191163497617*^9}, 3.975191352759687*^9, {3.9751935047297583`*^9, 
   3.9751935399805527`*^9}, {3.975203851455236*^9, 3.975203856541642*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"efc4d27a-0194-4dc0-bafc-75fec25698bd"],

Cell[BoxData[
 RowBox[{"ParallelTable", "[", 
  RowBox[{
   RowBox[{"N", "[", 
    RowBox[{
     RowBox[{"Counts", "[", 
      RowBox[{"pred", "/@", 
       RowBox[{"group", "[", "i", "]"}]}], "]"}], "/", 
     RowBox[{"trainSize", "[", "i", "]"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "0", ",", "9"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.975192791065476*^9, 3.9751928261179657`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"70d059f0-b123-451b-bbe0-68b5b8cde646"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dual formulation", "Section",
 CellChangeTimes->{{3.975111725288025*^9, 
  3.9751117269665747`*^9}},ExpressionUUID->"536704f6-ad0b-4026-8246-\
bd0abbe3ac24"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nums", "=", 
   RowBox[{"{", 
    RowBox[{"5", ",", "8"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"group", "/@", "nums"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"vec", "/@", "data"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"y", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"1", ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"group", "[", 
         RowBox[{"nums", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", 
   RowBox[{"Length", "[", "y", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yyT", "=", 
   RowBox[{"Outer", "[", 
    RowBox[{"Times", ",", "y", ",", "y"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Q", "=", 
   RowBox[{"yyT", " ", 
    RowBox[{"(", 
     RowBox[{"X", ".", 
      RowBox[{"Transpose", "[", "X", "]"}]}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.974565549490016*^9, 3.974565596394614*^9}, {
   3.9745658210151033`*^9, 3.974565826426064*^9}, {3.974565870685273*^9, 
   3.9745659508639793`*^9}, 3.9745659830221853`*^9, 3.974566275550365*^9, {
   3.974566486430994*^9, 3.97456648994239*^9}, {3.975193033608604*^9, 
   3.975193034462729*^9}},ExpressionUUID->"f01feebd-6455-41d2-9115-\
8ad256fcc6cf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"error", "[", "\[Alpha]_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Alpha]", ".", "Q", ".", "\[Alpha]"}], "/", "2"}], "-", 
   RowBox[{"Total", "[", "\[Alpha]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", "\[Alpha]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Q", ".", "\[Alpha]"}], "-", "1"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"proj", "[", "vec_", "]"}], ":=", 
  RowBox[{"vec", "-", 
   RowBox[{
    RowBox[{"y", ".", "vec"}], " ", 
    RowBox[{"y", "/", "n"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projC", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"vec", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
     RowBox[{"vec", "-", 
      RowBox[{
       RowBox[{"y", ".", "vec"}], " ", 
       RowBox[{"y", "/", "n"}]}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.974565984994092*^9, 3.974566063685028*^9}, {
   3.974566106790341*^9, 3.974566121981956*^9}, {3.974566366667062*^9, 
   3.974566366750407*^9}, {3.974733141238996*^9, 3.974733154335086*^9}, 
   3.974733194636333*^9},
 CellLabel->"In[28]:=",ExpressionUUID->"bcc367b2-6fe4-412f-b90f-d6f46caa157b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"lr", "=", 
   RowBox[{"4", " ", 
    SuperscriptBox["10", 
     RowBox[{"-", "5"}]]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iters", "=", "1000000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", "n"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"clip", "=", "0.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"0", ",", "\"\< \>\"", ",", 
   RowBox[{"prevError", "=", 
    RowBox[{"error", "[", "\[Alpha]", "]"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"AbsoluteTiming", "[", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Alpha]", "-=", 
      RowBox[{"lr", " ", 
       RowBox[{"grad", "[", "\[Alpha]", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"y", ".", "\[Alpha]"}], "]"}], ">", "tol"}], ",", 
       RowBox[{"\[Alpha]", "=", 
        RowBox[{"Clip", "[", 
         RowBox[{
          RowBox[{"projC", "[", "\[Alpha]", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "clip"}], "}"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"currentError", "=", 
      RowBox[{"error", "[", "\[Alpha]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{"i", ",", "100"}], "]"}], "==", "0"}], ",", 
       RowBox[{"Print", "[", 
        RowBox[{
        "i", ",", "\"\< \>\"", ",", "currentError", ",", "\"\< \>\"", ",", 
         RowBox[{"Max", "[", "\[Alpha]", "]"}], ",", "\"\< \>\"", ",", 
         RowBox[{"y", ".", "\[Alpha]"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"prevError", "/", "currentError"}], "-", "1"}], "]"}], "<", 
        "tol"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<converged at iteration \>\"", ",", " ", "i"}], "]"}], ";", 
        RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"currentError", ">", "0"}], ",", 
       RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"prevError", "=", "currentError"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "iters"}], "}"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.974566156092381*^9, 3.9745662694979897`*^9}, {
   3.974566328419623*^9, 3.974566349307869*^9}, 3.97456650382067*^9, {
   3.974566712614883*^9, 3.974566744607065*^9}, {3.974566812468609*^9, 
   3.974566851052203*^9}, {3.9745669046042213`*^9, 3.9745669071821623`*^9}, {
   3.9745669856216593`*^9, 3.974566990592412*^9}, {3.974567040526936*^9, 
   3.9745670486027937`*^9}, {3.9745671208680696`*^9, 3.974567122929554*^9}, {
   3.974567199222417*^9, 3.974567210157858*^9}, {3.974567634934523*^9, 
   3.9745676367002*^9}, {3.974567826135129*^9, 3.974567874396759*^9}, {
   3.974586039445179*^9, 3.974586081125589*^9}, {3.9745882657594223`*^9, 
   3.974588307367498*^9}, {3.974591973461669*^9, 3.974591984307808*^9}, {
   3.974592985647826*^9, 3.97459300707953*^9}, {3.974733156896441*^9, 
   3.9747331857996187`*^9}, 3.974736587301838*^9, {3.974763176909637*^9, 
   3.9747631770164833`*^9}, 3.975105393141008*^9, 3.97510917117845*^9},
 CellLabel->"In[32]:=",ExpressionUUID->"26151417-3f86-47cf-87a6-1da2a7eee419"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"{", "\[Alpha]", "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.974733334843582*^9, 3.97473333781308*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"7b0a9748-a12e-42be-bce1-6975d4943989"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"w", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"\[Alpha]", " ", "y"}], ")"}], ".", "X"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pos", "=", 
   RowBox[{
    RowBox[{"FirstPosition", "[", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"Max", "[", "\[Alpha]", "]"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", 
   RowBox[{
    RowBox[{"y", "[", 
     RowBox[{"[", "pos", "]"}], "]"}], "-", 
    RowBox[{"w", ".", 
     RowBox[{"X", "[", 
      RowBox[{"[", "pos", "]"}], "]"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9747338011705313`*^9, 3.974733831922126*^9}, {
  3.974733890903574*^9, 3.974733911740576*^9}, {3.974734343357641*^9, 
  3.974734376799368*^9}, {3.97473442321624*^9, 3.974734447866987*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"fe82829a-c4f4-43ce-b9a2-ab50e62b0986"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Results", "Section",
 CellChangeTimes->{{3.975117240027766*^9, 
  3.975117240644806*^9}},ExpressionUUID->"281cba65-1280-4cc7-b1dc-\
6e5e224b2afe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pred", "[", 
   RowBox[{"w_", ",", "x_", ",", "b_"}], "]"}], ":=", 
  RowBox[{"Sign", "[", 
   RowBox[{
    RowBox[{"w", ".", "x"}], "+", "b"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"predData", "[", 
   RowBox[{"w_", ",", "data_", ",", "b_"}], "]"}], ":=", 
  RowBox[{"Sign", "[", 
   RowBox[{
    RowBox[{"data", ".", "w"}], "+", "b"}], "]"}]}], "\n", 
 RowBox[{"N", "[", 
  RowBox[{
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"predData", "[", 
      RowBox[{"w", ",", 
       RowBox[{"X", "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"trainSize", "[", 
           RowBox[{"nums", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", "b"}],
       "]"}], ",", "1"}], "]"}], "/", 
   RowBox[{"trainSize", "[", 
    RowBox[{"nums", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"N", "[", 
  RowBox[{
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"predData", "[", 
      RowBox[{"w", ",", 
       RowBox[{"X", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"trainSize", "[", 
            RowBox[{"nums", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";;"}], "]"}], "]"}], ",",
        "b"}], "]"}], ",", 
     RowBox[{"-", "1"}]}], "]"}], "/", 
   RowBox[{"trainSize", "[", 
    RowBox[{"nums", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"N", "[", 
  RowBox[{
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"predData", "[", 
      RowBox[{"w", ",", 
       RowBox[{"(", 
        RowBox[{"vec", "/@", 
         RowBox[{"groupTest", "[", 
          RowBox[{"nums", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ")"}], ",", "b"}], "]"}], 
     ",", "1"}], "]"}], "/", 
   RowBox[{"testSize", "[", 
    RowBox[{"nums", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"N", "[", 
  RowBox[{
   RowBox[{"Count", "[", 
    RowBox[{
     RowBox[{"predData", "[", 
      RowBox[{"w", ",", 
       RowBox[{"(", 
        RowBox[{"vec", "/@", 
         RowBox[{"groupTest", "[", 
          RowBox[{"nums", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}], ",", "b"}], "]"}], 
     ",", 
     RowBox[{"-", "1"}]}], "]"}], "/", 
   RowBox[{"testSize", "[", 
    RowBox[{"nums", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.974733873050949*^9, 3.9747338891436567`*^9}, {
  3.974736093885951*^9, 3.974736100845482*^9}, {3.975117272354827*^9, 
  3.97511728068403*^9}, {3.975169937550405*^9, 3.975169948694059*^9}, {
  3.9751702946707478`*^9, 3.9751703042057657`*^9}, {3.975170394080862*^9, 
  3.975170446186007*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"e2fec24f-d7eb-4041-b818-dcaab116e10e"]
}, Open  ]]
},
WindowSize->{864, 1051},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e0440c36-59ab-4411-9342-55cfa3896495"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[576, 22, 150, 3, 66, "Section",ExpressionUUID->"7ca5f1cd-f358-42fd-96e9-3ac7d11fea99"],
Cell[729, 27, 1882, 54, 151, "Input",ExpressionUUID->"dfa783ae-a4f4-4ca2-b14c-c8f9868fadbd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2648, 86, 164, 3, 66, "Section",ExpressionUUID->"769dd8b2-357b-4d11-9b99-7b7bfea82f9c"],
Cell[2815, 91, 2487, 67, 112, "Input",ExpressionUUID->"4db99a3d-ad92-45ed-834b-1e930a180994"],
Cell[5305, 160, 1091, 33, 111, "Input",ExpressionUUID->"567ea129-b721-497b-ae7f-51fc3535c904"],
Cell[6399, 195, 3006, 75, 274, "Input",ExpressionUUID->"f4a88bee-36d4-488d-978f-302997e48135"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9442, 275, 160, 3, 66, "Section",ExpressionUUID->"58877aa2-3427-4db6-a4f3-64f5a544e457"],
Cell[9605, 280, 7932, 214, 582, "Input",ExpressionUUID->"efc4d27a-0194-4dc0-bafc-75fec25698bd"],
Cell[17540, 496, 492, 12, 29, "Input",ExpressionUUID->"70d059f0-b123-451b-bbe0-68b5b8cde646"]
}, Open  ]],
Cell[CellGroupData[{
Cell[18069, 513, 163, 3, 66, "Section",ExpressionUUID->"536704f6-ad0b-4026-8246-bd0abbe3ac24"],
Cell[18235, 518, 1733, 48, 151, "Input",ExpressionUUID->"f01feebd-6455-41d2-9115-8ad256fcc6cf"],
Cell[19971, 568, 1217, 32, 90, "Input",ExpressionUUID->"bcc367b2-6fe4-412f-b90f-d6f46caa157b"],
Cell[21191, 602, 3669, 85, 274, "Input",ExpressionUUID->"26151417-3f86-47cf-87a6-1da2a7eee419"],
Cell[24863, 689, 237, 4, 29, "Input",ExpressionUUID->"7b0a9748-a12e-42be-bce1-6975d4943989"],
Cell[25103, 695, 916, 24, 70, "Input",ExpressionUUID->"fe82829a-c4f4-43ce-b9a2-ab50e62b0986"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26056, 724, 152, 3, 66, "Section",ExpressionUUID->"281cba65-1280-4cc7-b1dc-6e5e224b2afe"],
Cell[26211, 729, 2870, 84, 131, "Input",ExpressionUUID->"e2fec24f-d7eb-4041-b818-dcaab116e10e"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

