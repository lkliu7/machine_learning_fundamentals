(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[      7579,        200]
NotebookOptionsPosition[      7134,        185]
NotebookOutlinePosition[      7526,        201]
CellTagsIndexPosition[      7483,        198]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rawText", "=", 
    RowBox[{"Import", "[", 
     RowBox[{"\"\<Downloads/enwik8\>\"", ",", "\"\<Text\>\""}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"remove", " ", "HTML", " ", "and", " ", "XML", " ", "tags"}], " ", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"enwik8", "=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{"rawText", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<<\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<>\>\""}], 
        "->", "\"\< \>\""}], ",", 
       RowBox[{
        RowBox[{"\"\<&\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<;\>\""}], 
        "->", "\"\< \>\""}], ",", 
       RowBox[{
        RowBox[{"\"\<http\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\< \>\""}], 
        "->", "\"\< \>\""}]}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"RemoveDiacritics", "[", "enwik8", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "keep", " ", "only", " ", "alphanumeric", " ", "characters", " ", "and", " ",
     "spaces"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"StringReplace", "[", 
     RowBox[{"enwik8", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Except", "[", 
         RowBox[{"WordCharacter", "|", "WhitespaceCharacter"}], "]"}], ".."}],
        "->", "\"\<\>\""}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"lowercase", " ", "all", " ", "text"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"ToLowerCase", "[", "enwik8", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"list", " ", "of", " ", "words"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"words", "=", 
   RowBox[{"StringSplit", "[", "enwik8", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordCounts", "=", 
   RowBox[{"Counts", "[", "words", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mostCommonWordsCounts", "=", 
   RowBox[{"TakeLargest", "[", 
    RowBox[{"wordCounts", ",", "10000"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mostCommonWords", "=", 
   RowBox[{"Keys", "[", "mostCommonWordsCounts", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordIndex", "=", 
   RowBox[{"AssociationThread", "[", 
    RowBox[{"mostCommonWords", ",", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "mostCommonWords", "]"}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.975550473927864*^9, 3.975550488197124*^9}, {
   3.97555052164465*^9, 3.975550522090289*^9}, 3.975551418794465*^9, {
   3.97561646264939*^9, 3.97561652694037*^9}, {3.975617326257259*^9, 
   3.975617327693283*^9}, {3.9756174936310863`*^9, 3.975617502691616*^9}, {
   3.975622164933201*^9, 3.975622175414694*^9}, {3.97562235900661*^9, 
   3.975622359304734*^9}, {3.975623253169256*^9, 3.975623261247229*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"8f669264-3c08-450f-a5fb-aae646d9419f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"StringToStream", "[", "enwik8", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nCols", "=", 
   RowBox[{"Length", "[", "mostCommonWords", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"row", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"MaxMemoryUsed", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"rowInds", ",", "colInds", ",", "vals"}], "}"}], "=", 
   RowBox[{
    RowBox[{"Reap", "[", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"StringQ", "[", 
         RowBox[{"line", "=", 
          RowBox[{"ReadLine", "[", "stream", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"w", "=", 
          RowBox[{"StringSplit", "[", "line", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "w", "]"}], "<", "3"}], ",", 
           RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ids", "=", 
          RowBox[{"Lookup", "[", 
           RowBox[{"wordIndex", ",", "w", ",", "Nothing"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"cnts", "=", 
          RowBox[{"Counts", "[", "ids", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"cols", "=", 
          RowBox[{"Keys", "[", "cnts", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"cts", "=", 
          RowBox[{"Values", "[", "cnts", "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"Sow", "[", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"row", ",", 
             RowBox[{"Length", "[", "cols", "]"}]}], "]"}], 
           ",", "\"\<r\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Sow", "[", 
          RowBox[{"cols", ",", "\"\<c\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Sow", "[", 
          RowBox[{"cts", ",", "\"\<v\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"row", "++"}]}]}], "]"}], ",", "_", ",", 
      RowBox[{
       RowBox[{"Developer`ToPackedArray", "[", 
        RowBox[{"Flatten", "[", "#2", "]"}], "]"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"documentWordFrequencyMatrix", "=", 
   RowBox[{"SparseArray", "[", 
    RowBox[{
     RowBox[{"coords", "->", "vals"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"row", "-", "1"}], ",", "nCols"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9756173205286922`*^9, 3.9756173798055887`*^9}, {
   3.975617423530046*^9, 3.9756174238777514`*^9}, {3.97562222471964*^9, 
   3.975622232777742*^9}, {3.975622301087296*^9, 3.975622333895855*^9}, {
   3.975622671150518*^9, 3.975622683540803*^9}, {3.9756227222640457`*^9, 
   3.975622748190426*^9}, {3.975622800124812*^9, 3.9756228420035458`*^9}, {
   3.975622886879261*^9, 3.9756228880780582`*^9}, {3.975623319966469*^9, 
   3.975623352078518*^9}, {3.975623416554646*^9, 3.975623524550756*^9}, {
   3.975623559821661*^9, 3.975623560828168*^9}, 3.975623679526009*^9, {
   3.9756256795607643`*^9, 3.975625706136592*^9}, {3.975625737520687*^9, 
   3.975625740437512*^9}, {3.9756257845903788`*^9, 
   3.975625785068161*^9}},ExpressionUUID->"eb28127b-def8-4679-b6f8-\
8dcd9f4c8c62"]
},
WindowSize->{1728, 1051},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"cfc9626b-a424-449c-a98d-995028b8d6fd"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 3195, 82, 294, "Input",ExpressionUUID->"8f669264-3c08-450f-a5fb-aae646d9419f"],
Cell[3752, 104, 3378, 79, 294, "Input",ExpressionUUID->"eb28127b-def8-4679-b6f8-8dcd9f4c8c62"]
}
]
*)

