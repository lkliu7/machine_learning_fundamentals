(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[     22610,        582]
NotebookOptionsPosition[     21782,        563]
NotebookOutlinePosition[     22173,        579]
CellTagsIndexPosition[     22130,        576]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"dims", "=", 
   RowBox[{"{", 
    RowBox[{"20", ",", "50", ",", "100"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9758010770993843`*^9, 3.975801081928841*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"b2082fb2-b99e-45d9-8de0-69a1efe87f26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"Import", "[", 
     RowBox[{"\"\<machine_learning_fundamentals/enwik8\>\"", 
      ",", "\"\<Text\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"remove", " ", "HTML", " ", "and", " ", "XML", " ", "tags"}], " ", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"enwik8", "=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{"enwik8", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<<\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<>\>\""}], 
        "->", "\"\< \>\""}], ",", 
       RowBox[{
        RowBox[{"\"\<&\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<;\>\""}], 
        "->", "\"\< \>\""}], ",", 
       RowBox[{
        RowBox[{"\"\<#\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\<;\>\""}], 
        "->", "\"\< \>\""}], ",", 
       RowBox[{
        RowBox[{"\"\<http\>\"", "~~", 
         RowBox[{"Shortest", "[", "___", "]"}], "~~", "\"\< \>\""}], 
        "->", "\"\< \>\""}]}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"RemoveDiacritics", "[", "enwik8", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "keep", " ", "only", " ", "alphanumeric", " ", "characters", " ", "and", " ",
     "spaces"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"StringReplace", "[", 
     RowBox[{"enwik8", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Except", "[", 
         RowBox[{"WordCharacter", "|", "WhitespaceCharacter"}], "]"}], ".."}],
        "->", "\"\<\>\""}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"lowercase", " ", "all", " ", "text"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enwik8", "=", 
    RowBox[{"ToLowerCase", "[", "enwik8", "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"list", " ", "of", " ", "words"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"words", "=", 
   RowBox[{"StringSplit", "[", "enwik8", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordCounts", "=", 
   RowBox[{"Counts", "[", "words", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mostCommonWordsCounts", "=", 
   RowBox[{"TakeLargest", "[", 
    RowBox[{"wordCounts", ",", "10000"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mostCommonWords", "=", 
   RowBox[{"Keys", "[", "mostCommonWordsCounts", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordSimPairs", "=", 
   RowBox[{"Rest", "[", 
    RowBox[{
    "Import", "[", "\"\<machine_learning_fundamentals/wordsim353crowd.csv\>\"",
      "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordSimWords", "=", 
   RowBox[{"ToLowerCase", "[", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Most", "/@", "wordSimPairs"}], "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mostCommonWords", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"mostCommonWords", ",", 
     RowBox[{"Complement", "[", 
      RowBox[{"wordSimWords", ",", "mostCommonWords"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wordIndex", "=", 
   RowBox[{"AssociationThread", "[", 
    RowBox[{"mostCommonWords", ",", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "mostCommonWords", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"StringToStream", "[", "enwik8", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nCols", "=", 
   RowBox[{"Length", "[", "mostCommonWords", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"row", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"AbsoluteTiming", "[", 
  RowBox[{"Monitor", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rowInds", ",", "colInds", ",", "vals"}], "}"}], "=", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"StringQ", "[", 
            RowBox[{"line", "=", 
             RowBox[{"ReadLine", "[", "stream", "]"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"w", "=", 
             RowBox[{"StringSplit", "[", "line", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "w", "]"}], "<=", "3"}], ",", 
              RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ids", "=", 
             RowBox[{"Lookup", "[", 
              RowBox[{"wordIndex", ",", "w", ",", "Nothing"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cnts", "=", 
             RowBox[{"Tally", "[", "ids", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"cols", "=", 
             RowBox[{"cnts", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cts", "=", 
             RowBox[{"cnts", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Sow", "[", 
             RowBox[{
              RowBox[{"ConstantArray", "[", 
               RowBox[{"row", ",", 
                RowBox[{"Length", "[", "cols", "]"}]}], "]"}], 
              ",", "\"\<r\>\""}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Sow", "[", 
             RowBox[{"cols", ",", "\"\<c\>\""}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Sow", "[", 
             RowBox[{"cts", ",", "\"\<v\>\""}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"row", "++"}]}]}], "]"}], ",", "_", ",", 
         RowBox[{
          RowBox[{"Developer`ToPackedArray", "[", 
           RowBox[{"Flatten", "[", "#2", "]"}], "]"}], "&"}]}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";"}], ",", "row"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"documentWordFrequencyMatrix", "=", 
   RowBox[{"SparseArray", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"rowInds", ",", "colInds"}], "}"}], "]"}], "->", "vals"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"row", "-", "1"}], ",", "nCols"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.975550473927864*^9, 3.975550488197124*^9}, {
   3.97555052164465*^9, 3.975550522090289*^9}, 3.975551418794465*^9, {
   3.97561646264939*^9, 3.97561652694037*^9}, {3.975617326257259*^9, 
   3.975617327693283*^9}, {3.9756174936310863`*^9, 3.975617502691616*^9}, {
   3.975622164933201*^9, 3.975622175414694*^9}, {3.97562235900661*^9, 
   3.975622359304734*^9}, {3.975623253169256*^9, 3.975623261247229*^9}, {
   3.9756262106264277`*^9, 3.975626239798129*^9}, 3.975626273729273*^9, {
   3.975626330315175*^9, 3.97562633857683*^9}, 3.9756279484791718`*^9, {
   3.975628284185932*^9, 3.975628288865267*^9}, 3.9756286415786858`*^9, {
   3.9756306454420156`*^9, 3.975630648730989*^9}, {3.975682199370062*^9, 
   3.975682203433428*^9}, {3.9757987979519167`*^9, 3.9757988203126307`*^9}, 
   3.975858663958736*^9, {3.975858936821896*^9, 3.975858987321232*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"2cb4acef-ef50-4eac-8083-48a5b0dd38e3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"matrixFactorization", "[", 
   RowBox[{"mat_", ",", "k_", ",", "l1_", ",", "l2_", ",", "steps_"}], "]"}], 
  ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", ",", "n", ",", "A", ",", "B", ",", "U", ",", "V"}], "}"}], ",",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "m"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "mat", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"V", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"m", ",", "k"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"A", "=", 
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", "V", "]"}], ".", "V"}], "+", 
           RowBox[{"l1", " ", 
            RowBox[{"IdentityMatrix", "[", "k", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"U", "=", 
         RowBox[{"V", ".", 
          RowBox[{"Transpose", "[", "A", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"U", "=", 
         RowBox[{"mat", ".", "U"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"B", "=", 
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", "U", "]"}], ".", "U"}], "+", 
           RowBox[{"l2", " ", 
            RowBox[{"IdentityMatrix", "[", "k", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"V", "=", 
         RowBox[{"B", ".", 
          RowBox[{"Transpose", "[", "U", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"V", "=", 
         RowBox[{"V", ".", "mat"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"V", "=", 
         RowBox[{"Transpose", "[", "V", "]"}]}]}], ",", "steps"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"U", ",", "V"}], "}"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"matrixFactorizationSGD", "[", 
   RowBox[{
   "mat_", ",", "k_", ",", "l1_", ",", "l2_", ",", "lr_", ",", "steps_"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "pos", ",", "U", ",", "V", ",", "u", ",", "v", ",", "du", ",", "dv", ",",
       "t", ",", "i", ",", "j", ",", "n", ",", "m"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "m"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "mat", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"V", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"m", ",", "k"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"U", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "k"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], "=", 
         RowBox[{"1", "+", 
          RowBox[{"RandomInteger", "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"n", "-", "1"}], ",", 
             RowBox[{"m", "-", "1"}]}], "}"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"u", "=", 
         RowBox[{"U", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"v", "=", 
         RowBox[{"V", "[", 
          RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{
          RowBox[{"-", "2"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"mat", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", 
            RowBox[{"u", ".", "v"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"du", "=", 
         RowBox[{
          RowBox[{"t", " ", "v"}], "+", 
          RowBox[{"2", "l1", " ", "u"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dv", "=", 
         RowBox[{
          RowBox[{"t", " ", "u"}], "+", 
          RowBox[{"2", "l2", " ", "v"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"u", "-=", 
         RowBox[{"lr", " ", "du"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"v", "-=", 
         RowBox[{"lr", " ", "dv"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"U", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "u"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"V", "[", 
          RowBox[{"[", "j", "]"}], "]"}], "=", "v"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"p", ",", "steps"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"U", ",", "V"}], "}"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.975762115429825*^9, 3.9757622786395283`*^9}, {
   3.9757623614528427`*^9, 3.975762363408266*^9}, 3.975762408322328*^9, {
   3.97577345378434*^9, 3.975773531905727*^9}, {3.975773571447144*^9, 
   3.9757735734123077`*^9}, {3.975776127790574*^9, 3.975776146829184*^9}, {
   3.975780355165175*^9, 3.975780387801382*^9}, {3.97578136277246*^9, 
   3.9757813704707537`*^9}, {3.975781403810316*^9, 3.975781405201764*^9}, 
   3.975858698845766*^9},
 CellLabel->"In[22]:=",ExpressionUUID->"279a1081-d08e-46c1-a666-6970c92b4b3b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{"MaxMemoryUsed", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Usvd", "[", "#", "]"}], ",", 
        RowBox[{"Ssvd", "[", "#", "]"}], ",", 
        RowBox[{"Vsvd", "[", "#", "]"}]}], "}"}], "=", 
      RowBox[{"SingularValueDecomposition", "[", 
       RowBox[{
        RowBox[{"N", "[", "documentWordFrequencyMatrix", "]"}], ",", "#"}], 
       "]"}]}], "]"}], "]"}], "&"}], "/@", "dims"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{"MaxMemoryUsed", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Ualt", "[", "#", "]"}], ",", 
        RowBox[{"Valt", "[", "#", "]"}]}], "}"}], "=", 
      RowBox[{"matrixFactorization", "[", 
       RowBox[{
       "documentWordFrequencyMatrix", ",", "#", ",", "1", ",", "1", ",", 
        "10"}], "]"}]}], "]"}], "]"}], "&"}], "/@", "dims"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{"MaxMemoryUsed", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Usgd", "[", "#", "]"}], ",", 
        RowBox[{"Vsgd", "[", "#", "]"}]}], "}"}], "=", 
      RowBox[{"matrixFactorizationSGD", "[", 
       RowBox[{"documentWordFrequencyMatrix", ",", "#", ",", "1", ",", "1", ",", 
        SuperscriptBox["10", 
         RowBox[{"-", "2"}]], ",", 
        SuperscriptBox["10", "6"]}], "]"}]}], "]"}], "]"}], "&"}], "/@", 
  "dims"}]}], "Input",
 CellChangeTimes->{{3.97567241408259*^9, 3.975672468311034*^9}, {
   3.975672764101708*^9, 3.9756727656342487`*^9}, {3.975761962855474*^9, 
   3.975761974731266*^9}, {3.9757624287498198`*^9, 3.975762460943782*^9}, 
   3.975800302100854*^9, {3.975801054796296*^9, 3.975801055332817*^9}, {
   3.97585868843406*^9, 3.975858691799979*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"a61d1d9c-7c71-4233-831b-6921fab8c56f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"N", ".", "B", "."}], ":", 
    RowBox[{
     RowBox[{
     "The", " ", "following", " ", "reconstruction", " ", "error", " ", 
      "computation", " ", "is", " ", "highly", " ", "memory"}], "-", 
     RowBox[{
      RowBox[{"intensive", ".", " ", "Uncomment"}], " ", "it", " ", "if", " ",
       "you", " ", "are", " ", "sure", " ", "you", " ", "want", " ", "to", " ",
       "run", " ", 
      RowBox[{"it", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"sparseReconstructionError", "[", 
     RowBox[{"mat_", ",", "U_", ",", "S_", ",", "V_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"reconstructed", "=", 
            RowBox[{"U", ".", "S", ".", 
             RowBox[{"Transpose", "[", "V", "]"}]}]}], ",", "norm1", ",", 
           "norm2", ",", "tr"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"norm1", " ", "=", " ", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"mat", ",", "\"\<Frobenius\>\""}], "]"}], "2"]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"norm2", "=", 
           RowBox[{"Total", "[", 
            RowBox[{
             SuperscriptBox["reconstructed", "2"], ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"tr", "=", 
           RowBox[{"2", 
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", "mat", "]"}], ".", "reconstructed"}], 
             "]"}]}]}], ";", "\[IndentingNewLine]", 
          SqrtBox[
           RowBox[{"norm1", "+", "norm2", "-", "tr"}]]}]}], "]"}], "\n", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"sparseReconstructionError", "[", 
          RowBox[{"documentWordFrequencyMatrix", ",", 
           RowBox[{"Ualt", "[", "#", "]"}], ",", 
           RowBox[{"IdentityMatrix", "[", "#", "]"}], ",", 
           RowBox[{"Valt", "[", "#", "]"}]}], "]"}], ",", 
         RowBox[{"sparseReconstructionError", "[", 
          RowBox[{"documentWordFrequencyMatrix", ",", 
           RowBox[{"Usgd", "[", "#", "]"}], ",", 
           RowBox[{"IdentityMatrix", "[", "#", "]"}], ",", 
           RowBox[{"Vsgd", "[", "#", "]"}]}], "]"}], ",", 
         RowBox[{"sparseReconstructionError", "[", 
          RowBox[{"documentWordFrequencyMatrix", ",", 
           RowBox[{"Usvd", "[", "#", "]"}], ",", 
           RowBox[{"Ssvd", "[", "#", "]"}], ",", 
           RowBox[{"Vsvd", "[", "#", "]"}]}], "]"}]}], "}"}]}], "&"}], "/@", 
     "dims"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.975799609093508*^9, 3.975799676580102*^9}, {
   3.975799967805334*^9, 3.975799969783918*^9}, {3.975800181179872*^9, 
   3.9758001821089153`*^9}, {3.9758005113586187`*^9, 3.975800545490766*^9}, {
   3.975800636552731*^9, 3.975800700603661*^9}, {3.975800943673705*^9, 
   3.975800946644679*^9}, 3.9758467267012157`*^9, {3.975848440446493*^9, 
   3.97584847739896*^9}, {3.97585773113244*^9, 3.9758577370737667`*^9}, {
   3.975858008525556*^9, 3.97585800980366*^9}, 3.975858496221446*^9, 
   3.975859757649085*^9},
 CellLabel->"In[27]:=",ExpressionUUID->"71d727b0-5e4b-4578-8fe2-513c9eb7a686"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cosineVsHuman", "=", 
   RowBox[{
    RowBox[{"Reap", "[", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"words", "=", 
         RowBox[{"ToLowerCase", "[", 
          RowBox[{"Most", "[", "pair", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"positions", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"FirstPosition", "[", 
             RowBox[{"mostCommonWords", ",", "#"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "words"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vecs", "=", 
         RowBox[{
          RowBox[{"Vsvd", "[", "20", "]"}], "[", 
          RowBox[{"[", "positions", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Sow", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"vecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ".", 
             RowBox[{"vecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"vecs", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], 
              RowBox[{"Norm", "[", 
               RowBox[{"vecs", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}]}], ",", 
           RowBox[{"pair", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"pair", ",", "wordSimPairs"}], "}"}]}], "]"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "cosineVsHuman", "]"}], "\[IndentingNewLine]", 
 RowBox[{"corr", "=", 
  RowBox[{"Correlation", "@@", 
   RowBox[{"Transpose", "[", "cosineVsHuman", "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.975859083930785*^9, 3.975859232092573*^9}, {
   3.975859275023045*^9, 3.9758592771572723`*^9}, {3.9758594082473793`*^9, 
   3.975859468063393*^9}, 3.975859624231269*^9, {3.975860787119212*^9, 
   3.975860828891706*^9}, {3.9758609696760798`*^9, 3.97586100129322*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"ed71c70c-106b-4ba7-958a-2665d8ad8f6a"]
},
WindowSize->{864, 1051},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"14.3 for Mac OS X ARM (64-bit) (July 8, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"cfc9626b-a424-449c-a98d-995028b8d6fd"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 279, 6, 29, "Input",ExpressionUUID->"b2082fb2-b99e-45d9-8de0-69a1efe87f26"],
Cell[836, 28, 7648, 191, 723, "Input",ExpressionUUID->"2cb4acef-ef50-4eac-8083-48a5b0dd38e3"],
Cell[8487, 221, 5713, 155, 560, "Input",ExpressionUUID->"279a1081-d08e-46c1-a666-6970c92b4b3b"],
Cell[14203, 378, 1938, 48, 199, "Input",ExpressionUUID->"a61d1d9c-7c71-4233-831b-6921fab8c56f"],
Cell[16144, 428, 3325, 74, 238, "Input",ExpressionUUID->"71d727b0-5e4b-4578-8fe2-513c9eb7a686"],
Cell[19472, 504, 2306, 57, 151, "Input",ExpressionUUID->"ed71c70c-106b-4ba7-958a-2665d8ad8f6a"]
}
]
*)

